#!/bin/sh -eu

# TLC Model Checker runner for Histrio project
# Usage: ./bin/run-spec <spec_name> [options]

PROJECT_ROOT="$(git rev-parse --show-toplevel)"
TLA_TOOLS="$PROJECT_ROOT/vendor/tla2tools.jar"

if [ ! -f "$TLA_TOOLS" ]; then
    echo "Error: tla2tools.jar not found at $TLA_TOOLS"
    echo "Please ensure vendor/tla2tools.jar exists"
    exit 1
fi

if [ $# -eq 0 ]; then
    echo "Usage: $0 <spec_name> [tlc_options]"
    echo "Example: $0 Histrio -workers auto"
    echo "Example: $0 Histrio -config models/SmallModel.cfg"
    exit 1
fi

SPEC_NAME="$1"
shift  # Remove spec name from arguments

# Default to specs directory for .tla files
SPEC_FILE="specs/$SPEC_NAME.tla"

if [ ! -f "$SPEC_FILE" ]; then
    echo "Error: Specification file not found: $SPEC_FILE"
    exit 1
fi

# Set Java path if needed
export PATH="/opt/homebrew/opt/openjdk@17/bin:$PATH"

echo "Running TLC on $SPEC_FILE with options: $*"
echo "Working directory: $PROJECT_ROOT"
echo

cd "$PROJECT_ROOT"
java -jar "$TLA_TOOLS" "$@" "$SPEC_FILE"